<!DOCTYPE html>
<html>
<head>
	<title>Homepage</title>
	<style type="text/css">
		#header {
			font-family: Arial;
			font-size: 30px;
		} #name {
			border-radius: 10px;
		} #number {
			border-radius: 10px;
		} #password {
			border-radius: 10px;
		} #sumbit {
			border-top: 10px;
			border-radius: 10px;
		} body {
			text-align: center;
			font-size: 20px;
		}
	</style>
	
	<script type="text/javascript">
		function loadData() {
			var xmlhttp = new XMLHttpRequest();
			var userName = 
				document.getElementById("name").value;
			var userPassword =
				document.getElementById("password").value;
			var userNumber = 
				document.getElementById("number").value;

			if (spotifyAuthentication(userName,userPassword)) {
				xmlhttp.onreadystatechange = function () {
					var PartyID = xmlhttp.responseText;
					setCookie("name",document.getElementById("name").value,1);
					document.getElementById("name").value = "";
					document.getElementById("number").value = "";
					document.getElementById("password").value = "";
					document.getElementById("PartyID").innerHTML = 
						"<h1>Your PartyID is:<br>"+PartyID+"</h1>";
					var button = document.createElement("button");
					var text = document.createTextNode("End Party");
					button.appendChild(text);
					button.onclick = logout;
					document.getElementById("logout").appendChild(button);
				}

				xmlhttp.open("GET","/newAdmin?name="+encodeURIComponent(userName)+"&number="+encodeURIComponent(userNumber),true);
				xmlhttp.send();
			}
		}
		function logout() {
			var params = "name="+getCookie("name");
			var xmlhttp = new XMLHttpRequest();

			document.getElementById("PartyID").innerHTML = "";
			document.getElementById("logout").innerHTML = "";

			xmlhttp.open("POST","/deleteParty");
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.onreadystatechange = function () {};
			xmlhttp.send(params);
		}
		function spotifyAuthentication(username, password) {
			//TODO: this.
			return true;
		}
		function setCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + (exdays*24*60*60*1000));
			var expires = "expires="+d.toUTCString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
		}
		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for(var i=0; i<ca.length; i++) {
			    var c = ca[i];
			    while (c.charAt(0)==' ') { c = c.substring(1); }
			    if (c.indexOf(name) == 0) { return c.substring(name.length,c.length); }
			}
			return "";
		}
	</script>
</head>

<body>
	<div id="login">
		Spotify username: </br><input type="text" name="name" id="name"/></br>
		Password: <br><input type="password" name="password" id="password"/><br>
		Cell number: </br><input type="text" name="number" id="number"/></br>
		<button id="submit" onclick="loadData()">Submit</button>
	</div>
	<div id="PartyID">
	</div>
	<div id="logout">
	<div>
</body>
</html>